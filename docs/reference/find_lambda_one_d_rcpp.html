<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Selecting Box-Cox parameter lambda in the one-dimensional case using
C++ via Rcpp — find_lambda_one_d_rcpp • rust</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Selecting Box-Cox parameter lambda in the one-dimensional case using
C++ via Rcpp — find_lambda_one_d_rcpp" />
<meta property="og:description" content="Finds a value of the Box-Cox transformation parameter lambda for which
the (positive univariate) random variable with log-density logf
has a density closer to that of a Gaussian random variable.
Works by estimating a set of quantiles of the distribution implied
by logf and treating those quantiles as data in a standard Box-Cox
analysis.  In the following we use theta to denote the argument of
logf on the original scale and phi on the Box-Cox transformed scale." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.12.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/rust-a-vignette.html">Introducing rust: Ratio-of-Uniforms Simulation with Transformation</a>
    </li>
    <li>
      <a href="../articles/rust-b-when-to-use-vignette.html">When can rust be used?</a>
    </li>
    <li>
      <a href="../articles/rust-c-using-rcpp-vignette.html">Rusting Faster: Simulation using Rcpp</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/paulnorthrop/rust/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Selecting Box-Cox parameter lambda in the one-dimensional case using
C++ via Rcpp</h1>
    <small class="dont-index">Source: <a href='https://github.com/paulnorthrop/rust/blob/master/R/box_cox_functions_rcpp.R'><code>R/box_cox_functions_rcpp.R</code></a></small>
    <div class="hidden name"><code>find_lambda_one_d_rcpp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Finds a value of the Box-Cox transformation parameter lambda for which
the (positive univariate) random variable with log-density logf
has a density closer to that of a Gaussian random variable.
Works by estimating a set of quantiles of the distribution implied
by logf and treating those quantiles as data in a standard Box-Cox
analysis.  In the following we use theta to denote the argument of
logf on the original scale and phi on the Box-Cox transformed scale.</p>
    </div>

    <pre class="usage"><span class='fu'>find_lambda_one_d_rcpp</span><span class='op'>(</span>
  <span class='va'>logf</span>,
  <span class='va'>...</span>,
  ep_bc <span class='op'>=</span> <span class='fl'>1e-04</span>,
  min_phi <span class='op'>=</span> <span class='va'>ep_bc</span>,
  max_phi <span class='op'>=</span> <span class='fl'>10</span>,
  num <span class='op'>=</span> <span class='fl'>1001L</span>,
  xdiv <span class='op'>=</span> <span class='fl'>100</span>,
  probs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0.01</span>, <span class='fl'>0.99</span>, by <span class='op'>=</span> <span class='fl'>0.01</span><span class='op'>)</span>,
  lambda_range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  phi_to_theta <span class='op'>=</span> <span class='cn'>NULL</span>,
  log_j <span class='op'>=</span> <span class='cn'>NULL</span>,
  user_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>logf</th>
      <td><p>A pointer to a compiled C++ function returning the log
of the target density \(f\).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments to be passed to <code>logf</code> and related
functions.</p></td>
    </tr>
    <tr>
      <th>ep_bc</th>
      <td><p>A (positive) numeric scalar. Smallest possible value of phi
to consider.  Used to avoid negative values of phi.</p></td>
    </tr>
    <tr>
      <th>min_phi, max_phi</th>
      <td><p>Numeric scalars.  Smallest and largest values
of phi at which to evaluate logf, i.e. the range of values of phi over
which to evaluate logf. Any components in min_phi that are not positive
are set to ep_bc.</p></td>
    </tr>
    <tr>
      <th>num</th>
      <td><p>A numeric scalar. Number of values at which to evaluate logf.</p></td>
    </tr>
    <tr>
      <th>xdiv</th>
      <td><p>A numeric scalar.  Only values of phi at which the density f is
greater than the (maximum of f) / <code>xdiv</code> are used.</p></td>
    </tr>
    <tr>
      <th>probs</th>
      <td><p>A numeric scalar. Probabilities at which to estimate the
quantiles of that will be used as data to find lambda.</p></td>
    </tr>
    <tr>
      <th>lambda_range</th>
      <td><p>A numeric vector of length 2.  Range of lambda over
which to optimise.</p></td>
    </tr>
    <tr>
      <th>phi_to_theta</th>
      <td><p>A pointer to a compiled C++ function returning
(the inverse) of the transformation from theta to phi used to ensure
positivity of phi prior to Box-Cox transformation.  The argument is
phi and the returned value is theta.  If <code>phi_to_theta</code>
is undefined at the input value then the function should return NA.</p></td>
    </tr>
    <tr>
      <th>log_j</th>
      <td><p>A pointer to a compiled C++ function returning the log of
the Jacobian of the transformation from theta to phi, i.e. based on
derivatives of phi with respect to theta. Takes theta as its argument.
If this is not supplied then a constant Jacobian is used.</p></td>
    </tr>
    <tr>
      <th>user_args</th>
      <td><p>A list of numeric components providing arguments to
the user-supplied functions <code>phi_to_theta</code> and <code>log_j</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list containing the following components</p>
<dt>lambda</dt><dd><p>A numeric scalar.  The value of <code>lambda</code>.</p></dd>
  <dt>gm</dt><dd><p>A numeric scalar.  Box-cox scaling parameter, estimated by the
    geometric mean of the quantiles used in the optimisation to find the
    value of lambda.</p></dd>
  <dt>init_psi</dt><dd><p>A numeric scalar.  An initial estimate of the mode of the
    Box-Cox transformed density</p></dd>
  <dt>sd_psi</dt><dd><p>A numeric scalar.  Estimates of the marginal standard
    deviations of the Box-Cox transformed variables.</p></dd>
 <dt>phi_to_theta</dt><dd><p>as detailed above (only if <code>phi_to_theta</code> is
   supplied)</p></dd>
 <dt>log_j</dt><dd><p>as detailed above (only if <code>log_j</code> is supplied)</p></dd>
 <dt>user_args</dt><dd><p>as detailed above (only if <code>user_args</code> is supplied)</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The general idea is to estimate quantiles of f corresponding to a
  set of equally-spaced probabilities in <code>probs</code> and to use these
  estimated quantiles as data in a standard estimation of the Box-Cox
  transformation parameter <code>lambda</code>.</p>
<p>The density f is first evaluated at <code>num</code> points equally spaced over
  the interval (<code>min_phi</code>, <code>max_phi</code>).  The continuous density f
  is approximated by attaching trapezium-rule estimates of probabilities
  to the midpoints of the intervals between the points.  After standardizing
  to account for the fact that f may not be normalized,
  (<code>min_phi</code>, <code>max_phi</code>) is reset so that values with small
  estimated probability (determined by <code>xdiv</code>) are excluded and the
  procedure is repeated on this new range.  Then the required quantiles are
  estimated by inferring them from a weighted empirical distribution
  function based on treating the midpoints as data and the estimated
  probabilities at the midpoints as weights.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Box, G. and Cox, D. R. (1964) An Analysis of Transformations.
 Journal of the Royal Statistical Society. Series B (Methodological), 26(2),
 211-252.</p>
<p>Andrews, D. F. and Gnanadesikan, R. and Warner, J. L. (1971)
 Transformations of Multivariate Data, Biometrics, 27(4).</p>
<p>Eddelbuettel, D. and Francois, R. (2011). Rcpp: Seamless
 R and C++ Integration. <em>Journal of Statistical Software</em>,
 <strong>40</strong>(8), 1-18.
 <a href='https://www.jstatsoft.org/v40/i08/'>https://www.jstatsoft.org/v40/i08/</a>.</p>
<p>Eddelbuettel, D. (2013). <em>Seamless R and C++ Integration
 with Rcpp</em>, Springer, New York. ISBN 978-1-4614-6867-7.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='ru_rcpp.html'>ru_rcpp</a></code> to perform ratio-of-uniforms sampling.</p>
<p><code><a href='find_lambda_rcpp.html'>find_lambda_rcpp</a></code> to produce (somewhat) automatically
  a list for the argument <code>lambda</code> of <code>ru</code> for any value of
  <code>d</code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># Log-normal density ===================</span>

<span class='co'># Note: the default value of max_phi = 10 is OK here but this will not</span>
<span class='co'># always be the case.</span>

<span class='va'>ptr_lnorm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='create_xptr.html'>create_xptr</a></span><span class='op'>(</span><span class='st'>"logdlnorm"</span><span class='op'>)</span>
<span class='va'>mu</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
<span class='va'>sigma</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>lambda</span> <span class='op'>&lt;-</span> <span class='fu'>find_lambda_one_d_rcpp</span><span class='op'>(</span>logf <span class='op'>=</span> <span class='va'>ptr_lnorm</span>, mu <span class='op'>=</span> <span class='va'>mu</span>, sigma <span class='op'>=</span> <span class='va'>sigma</span><span class='op'>)</span>
<span class='va'>lambda</span>
</div><div class='output co'>#&gt; $lambda
#&gt; [1] 0.06564725
#&gt; 
#&gt; $gm
#&gt; [1] 0.9535484
#&gt; 
#&gt; $init_psi
#&gt; [1] -0.06345259
#&gt; 
#&gt; $sd_psi
#&gt; [1] 0.9753502
#&gt; 
#&gt; $user_args
#&gt; list()
#&gt; </div><div class='input'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='ru_rcpp.html'>ru_rcpp</a></span><span class='op'>(</span>logf <span class='op'>=</span> <span class='va'>ptr_lnorm</span>, mu <span class='op'>=</span> <span class='va'>mu</span>, sigma <span class='op'>=</span> <span class='va'>sigma</span>, log <span class='op'>=</span> <span class='cn'>TRUE</span>, d <span class='op'>=</span> <span class='fl'>1</span>,
             n <span class='op'>=</span> <span class='fl'>1000</span>, trans <span class='op'>=</span> <span class='st'>"BC"</span>, lambda <span class='op'>=</span> <span class='va'>lambda</span><span class='op'>)</span>

<span class='co'># Gamma density ===================</span>

<span class='va'>alpha</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='co'># Choose a sensible value of max_phi</span>
<span class='va'>max_phi</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>qgamma</a></span><span class='op'>(</span><span class='fl'>0.999</span>, shape <span class='op'>=</span> <span class='va'>alpha</span><span class='op'>)</span>
<span class='co'># [I appreciate that typically the quantile function won't be available.</span>
<span class='co'># In practice the value of lambda chosen is quite insensitive to the choice</span>
<span class='co'># of max_phi, provided that max_phi is not far too large or far too small.]</span>

<span class='va'>ptr_gam</span> <span class='op'>&lt;-</span> <span class='fu'><a href='create_xptr.html'>create_xptr</a></span><span class='op'>(</span><span class='st'>"logdgamma"</span><span class='op'>)</span>
<span class='va'>lambda</span> <span class='op'>&lt;-</span> <span class='fu'>find_lambda_one_d_rcpp</span><span class='op'>(</span>logf <span class='op'>=</span> <span class='va'>ptr_gam</span>, alpha <span class='op'>=</span> <span class='va'>alpha</span>,
                                 max_phi <span class='op'>=</span> <span class='va'>max_phi</span><span class='op'>)</span>
<span class='va'>lambda</span>
</div><div class='output co'>#&gt; $lambda
#&gt; [1] 0.2727968
#&gt; 
#&gt; $gm
#&gt; [1] 0.5689906
#&gt; 
#&gt; $init_psi
#&gt; [1] -0.2016904
#&gt; 
#&gt; $sd_psi
#&gt; [1] 0.7835109
#&gt; 
#&gt; $user_args
#&gt; list()
#&gt; </div><div class='input'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='ru_rcpp.html'>ru_rcpp</a></span><span class='op'>(</span>logf <span class='op'>=</span> <span class='va'>ptr_gam</span>, alpha <span class='op'>=</span> <span class='va'>alpha</span>, d <span class='op'>=</span> <span class='fl'>1</span>, n <span class='op'>=</span> <span class='fl'>1000</span>, trans <span class='op'>=</span> <span class='st'>"BC"</span>,
             lambda <span class='op'>=</span> <span class='va'>lambda</span><span class='op'>)</span>

<span class='va'>alpha</span> <span class='op'>&lt;-</span> <span class='fl'>0.1</span>
<span class='co'># NB. for alpha &lt; 1 the gamma(alpha, beta) density is not bounded</span>
<span class='co'># So the ratio-of-uniforms emthod can't be used but it may work after a</span>
<span class='co'># Box-Cox transformation.</span>
<span class='co'># find_lambda_one_d() works much better than find_lambda() here.</span>

<span class='va'>max_phi</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>qgamma</a></span><span class='op'>(</span><span class='fl'>0.999</span>, shape <span class='op'>=</span> <span class='va'>alpha</span><span class='op'>)</span>
<span class='va'>lambda</span> <span class='op'>&lt;-</span> <span class='fu'>find_lambda_one_d_rcpp</span><span class='op'>(</span>logf <span class='op'>=</span> <span class='va'>ptr_gam</span>, alpha <span class='op'>=</span> <span class='va'>alpha</span>,
                                 max_phi <span class='op'>=</span> <span class='va'>max_phi</span><span class='op'>)</span>
<span class='va'>lambda</span>
</div><div class='output co'>#&gt; $lambda
#&gt; [1] 0.06758891
#&gt; 
#&gt; $gm
#&gt; [1] 0.008056577
#&gt; 
#&gt; $init_psi
#&gt; [1] -0.0342618
#&gt; 
#&gt; $sd_psi
#&gt; [1] 0.009372876
#&gt; 
#&gt; $user_args
#&gt; list()
#&gt; </div><div class='input'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='ru_rcpp.html'>ru_rcpp</a></span><span class='op'>(</span>logf <span class='op'>=</span> <span class='va'>ptr_gam</span>, alpha <span class='op'>=</span> <span class='va'>alpha</span>, d <span class='op'>=</span> <span class='fl'>1</span>, n <span class='op'>=</span> <span class='fl'>1000</span>, trans <span class='op'>=</span> <span class='st'>"BC"</span>,
             lambda <span class='op'>=</span> <span class='va'>lambda</span><span class='op'>)</span>
<span class='co'># \donttest{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</div><div class='img'><img src='find_lambda_one_d_rcpp-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span>, ru_scale <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='img'><img src='find_lambda_one_d_rcpp-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Paul J. Northrop.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


